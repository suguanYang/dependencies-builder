# 依赖管理系统

## 概述

DMS（Dependency Management System）是一个全面的依赖管理系统，专门用于管理和分析为前端场景下跨多个代码仓库的项目依赖关系。该系统通过静态分析技术([CodeQL](https://codeql.github.com/docs/codeql-overview/about-codeql/))识别和跟踪代码中的各种依赖关系，帮助开发团队预防依赖破坏问题。

DMS 的主要目标是：
- **依赖验证**：确保代码变更不会破坏现有的依赖关系
- **影响分析**：分析代码变更对依赖关系的影响范围
- **跨项目管理**：管理多个项目间的复杂依赖关系

## 相关概念

### 1. 节点 (Node)
代表代码中的依赖关系点，包含以下属性：
- `project`：所属项目
- `type`：节点类型（见下文）
- `name`：节点名称
- `relativePath`：源代码相对路径
- `startLine/startColumn`：源代码起始位置
- `endLine/endColumn`：源代码结束位置

### 2. 关系 (Connection)
代表两个节点之间的依赖关系：
- `fromId`：源节点 ID
- `toId`：目标节点 ID

## 节点类型 (NodeType)

DMS 支持多种类型的依赖关系：

### 1. ESM静态依赖（构建时集成）
- **NamedExport**：命名导出
- **NamedImport**：命名导入

### 2. 动态依赖（运行时集成）
- **RuntimeDynamicImport**：运行时动态导入
- **GlobalVarRead**：全局变量读取
- **GlobalVarWrite**：全局变量写入
- **WebStorageRead**：Web 存储读取(localStorage, sessionStorage)
- **WebStorageWrite**：Web 存储写入
- **EventOn**：事件监听
- **EventEmit**：事件触发
- **DynamicModuleFederationReference**：动态模块联邦引用

## Web 界面功能

### 1. /projects
- 查看所有项目列表
- 添加/编辑/删除项目
- 项目类型筛选

### 2. /nodes
- 查看所有依赖节点
- 按项目、分支、类型筛选
- 节点详细信息查看

### 3. /actions
- 查看任务状态
- 创建新的分析任务
- 查看分析结果和错误

## 主要功能

#### 1. 执行静态分析

**目的**：分析指定项目的代码依赖关系

**操作步骤**：
1. 进入 "Actions" 页面 点击 "Create Action" 按钮
2. 在弹出窗口中填写以下信息：
   - **Project**：选择或输入要分析的项目
   - **Branch**：指定要分析的分支名称（如：test）
   - **Action Type**：选择 "Analysis"（分析）
   - **Ignore Call Graph**：可选，勾选可加快分析速度但会跳过代码调用栈生成，而无法进行依赖变更报告
3. 点击 "Create & Run" 按钮

**结果查看**：
- 分析完成后，可以在Nodes页面查看生成的依赖节点
- 在 "Nodes" 页面查看所有发现的依赖关系
- 在 "Connections" 页面点击 "Auto-create Connections" 自动建立同其他项目的依赖关系

#### 2. 生成变更报告

**目的**：比较两个分支的差异，了解代码变更的影响

**操作步骤**：
1. 进入 "Actions" 页面 点击 "Create Action" 按钮
2. 在弹出窗口中填写以下信息：
   - **Project**：选择要分析的项目
   - **Branch**：指定当前分支（要比较的分支, 如feature/abc）
   - **Action Type**：选择 "Report"（报告）
   - **Target Branch**：指定要对比的目标分支（如：test）
3. 点击 "Create & Run" 按钮
4. 系统开始生成报告

**报告内容**：
- 进入 "Reports" 界面， 查看报告结果
- 显示受影响的节点列表
- 标识新增、修改、删除的依赖关系

### 使用场景示例

#### 场景1：新功能开发前的依赖分析
1. 在开发新功能前，对当前分支执行静态分析
2. 了解现有依赖结构，避免破坏现有功能
3. 根据分析结果设计新功能的依赖关系

#### 场景2：代码合并前的变更评估
1. 在合并分支前，生成当前分支与目标分支的对比报告
2. 查看变更对依赖关系的影响
3. 根据报告结果决定是否需要调整代码

#### 场景3：架构重构影响分析
1. 对重构后的代码执行分析
2. 比较重构前后的依赖变化
3. 确保重构没有破坏现有依赖关系

### 常见问题

#### Q: 如何添加其他仓库的项目？
A: 在项目管理页面点击 "添加项目" 按钮，填写项目地址时需要添加auth信息，如： https://user:password@example.com

#### Q: 为何无法修改/删除数据
A: 公司网络安全策略，如要修改请联系管理员